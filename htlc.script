OP_IF OP_HASH256 {secret_hash} OP_EQUALVERIFY OP_DUP OP_HASH160 {recipient_address_hash} OP_EQUALVERIFY OP_CHECKSIG OP_ELSE {endtime} OP_CHECKLOCKTIMEVERIFY OP_DROP OP_DUP OP_HASH160 {sender_address_hash} OP_EQUALVERIFY OP_CHECKSIG OP_ENDIF